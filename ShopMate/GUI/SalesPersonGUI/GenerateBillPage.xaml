<Page
    x:Class="ShopMate.GUI.GenerateBillPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:ShopMate.GUI.Controls"
    xmlns:dto="using:ShopMate.DTOs"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.Resources>

        <!-- Make ListView items fill width -->
        <Style x:Key="ListViewItemStretchStyle" TargetType="ListViewItem">
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="Margin" Value="0" />
        </Style>

        <!-- Minimal header label -->
        <Style x:Key="HeaderLabel" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="#E5E7EB" />
            <Setter Property="FontSize" Value="14" />
        </Style>

        <!-- Dark panel card -->
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="#1A1C1E" />
            <Setter Property="BorderBrush" Value="#2A2D31" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="Padding" Value="20" />
        </Style>

        <!-- Dark inputs -->
        <Style x:Key="InputComboStyle" TargetType="ComboBox">
            <Setter Property="Background" Value="#1F2123" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderBrush" Value="#3A3D40" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="8" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="FontSize" Value="14" />
        </Style>

        <Style x:Key="NumberBoxStyle" TargetType="NumberBox">
            <Setter Property="Background" Value="#1F2123" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="BorderBrush" Value="#3A3D40" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="8" />
            <Setter Property="CornerRadius" Value="6" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="SpinButtonPlacementMode" Value="Inline" />
        </Style>

    </Page.Resources>


    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition x:Name="SidebarColumn" Width="170" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!-- SIDEBAR -->
        <controls:SalesSidebarControl Grid.Column="0" />


        <!-- ==== MAIN CONTENT ==== -->
        <ScrollViewer Grid.Column="1">
            <StackPanel Padding="40" Spacing="20">

                <!-- BACK + TITLE -->
                <Grid ColumnSpacing="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <Button Width="32"
                            Height="32"
                            Background="#1F2123"
                            BorderBrush="#3A3D40"
                            BorderThickness="1"
                            CornerRadius="6"
                            Padding="0"
                            Click="OnBackClicked">
                        <Image Source="ms-appx:///Assets/Icons/back.png"
                               Width="20" Height="20"/>
                    </Button>

                    <TextBlock Text="Generate Bill"
                               Grid.Column="1"
                               FontSize="28"
                               FontWeight="SemiBold"
                               Foreground="White"
                               VerticalAlignment="Center" />
                </Grid>

                <TextBlock Text="Create bills quickly and add items."
                           FontSize="13"
                           Foreground="#9CA3AF" />

                <!-- KPI SLIM ROW -->
                <StackPanel Orientation="Horizontal"
                            Spacing="24"
                            Margin="0,4,0,10">

                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="Sales:"
                                   Foreground="#9CA3AF"
                                   FontSize="13" />
                        <TextBlock x:Name="TotalSalesTextBlock"
                                   Foreground="White"
                                   FontSize="13" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="Bills:"
                                   Foreground="#9CA3AF"
                                   FontSize="13" />
                        <TextBlock x:Name="TotalBillsTextBlock"
                                   Foreground="White"
                                   FontSize="13" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="Avg:"
                                   Foreground="#9CA3AF"
                                   FontSize="13" />
                        <TextBlock x:Name="AvgBillValTextBlock"
                                   Foreground="White"
                                   FontSize="13" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="Low Stock:"
                                   Foreground="#9CA3AF"
                                   FontSize="13" />
                        <TextBlock x:Name="LowStockTextBlock"
                                   Foreground="White"
                                   FontSize="13" />
                    </StackPanel>

                </StackPanel>


                <!-- MAIN 2-COLUMN LAYOUT -->
                <Grid ColumnSpacing="20" Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>


                    <!-- LEFT CARD: BILL CREATION -->
                    <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                        <StackPanel Spacing="12">

                            <TextBlock Text="Bill Details"
                                       FontSize="20"
                                       FontWeight="SemiBold"
                                       Foreground="White" />

                            <!-- Customer -->
                            <ComboBox x:Name="CustomerComboBox"
                                      Header="Select Customer"
                                      Style="{StaticResource InputComboStyle}"
                                      DisplayMemberPath="Name"
                                      SelectedValuePath="ID"
                                      Width="320" />


                            <!-- Product + quantity + add -->
                            <StackPanel Orientation="Horizontal" Spacing="12">

                                <ComboBox x:Name="ProductComboBox"
                                          Header="Product"
                                          Width="320"
                                          Style="{StaticResource InputComboStyle}"
                                          DisplayMemberPath="Name"
                                          SelectedValuePath="Id"
                                          SelectionChanged="ProductComboBox_SelectionChanged" />

                                <NumberBox x:Name="QuantityNumberBox"
                                           Header="Qty"
                                           Minimum="1"
                                           Style="{StaticResource NumberBoxStyle}" />

                                <Button Content="Add"
                                        Width="80" Height="36"
                                        VerticalAlignment="Bottom"
                                        Background="#3B82F6"
                                        Foreground="White"
                                        BorderBrush="Transparent"
                                        Click="AddItem_Click" />
                            </StackPanel>


                            <!-- TABLE HEADER -->
                            <Grid Margin="0,8,0,4" ColumnSpacing="10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="70" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="80" />
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="Product" Style="{StaticResource HeaderLabel}" />
                                <TextBlock Text="Price" Grid.Column="1" Style="{StaticResource HeaderLabel}"
                                           HorizontalAlignment="Right" />
                                <TextBlock Text="Qty" Grid.Column="2" Style="{StaticResource HeaderLabel}"
                                           HorizontalAlignment="Center" />
                                <TextBlock Text="Total" Grid.Column="3" Style="{StaticResource HeaderLabel}"
                                           HorizontalAlignment="Right" />
                            </Grid>

                            <Rectangle Height="1" Fill="#2A2D31" />


                            <!-- BILL ITEMS LIST -->
                                <ListView x:Name="BillItemsListView"
                                          ItemsSource="{Binding BillItems}"
                                          ItemContainerStyle="{StaticResource ListViewItemStretchStyle}"
                                          SelectionMode="None">

                                    <ListView.ItemTemplate>
                                        <DataTemplate x:DataType="dto:BillItemVm">
                                            <Grid Padding="8" ColumnSpacing="10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="2*" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="70" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="80" />
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Text="{x:Bind ProductName}"
                                                           VerticalAlignment="Center"
                                                           Foreground="White" />

                                                <TextBlock Text="{x:Bind UnitPrice}"
                                                           Grid.Column="1"
                                                           HorizontalAlignment="Right"
                                                           VerticalAlignment="Center"
                                                           Foreground="White" />

                                            <TextBlock Text="{x:Bind Quantity, Mode=OneWay}"
                                                           Grid.Column="2"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"
                                                           Foreground="White" />

                                            <TextBlock Text="{x:Bind Total, Mode=OneWay}"
                                                           Grid.Column="3"
                                                           HorizontalAlignment="Right"
                                                           VerticalAlignment="Center"
                                                           Foreground="White" />

                                                <Button Content="Remove"
                                                        Grid.Column="4"
                                                        Width="70"
                                                        Background="#7A0000"
                                                        Foreground="White"
                                                        BorderBrush="Transparent"
                                                        Click="RemoveItem_Click" />
                                            </Grid>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                                
                        </StackPanel>
                    </Border>

                    <!-- RIGHT CARD: SUMMARY -->
                    <Border Grid.Column="1" Style="{StaticResource CardStyle}">
                        <StackPanel Spacing="16">

                            <TextBlock Text="Summary"
                                       FontSize="20"
                                       FontWeight="SemiBold"
                                       Foreground="White" />

                            <TextBlock x:Name="TotalItemsTextBlock" Foreground="#D1D5DB" />
                            <TextBlock x:Name="SubtotalTextBlock" Foreground="#D1D5DB" />
                            <TextBlock x:Name="TotalTextBlock"
                                       FontSize="20"
                                       FontWeight="Bold"
                                       Foreground="White" />

                            <Button Content="Generate Bill"
                                    Background="#3B82F6"
                                    Foreground="White"
                                    BorderBrush="Transparent"
                                    CornerRadius="6"
                                    Padding="10,8"
                                    Click="GenerateBill_Click" />
                        </StackPanel>
                    </Border>

                </Grid>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>